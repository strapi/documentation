name: Prevent "auto-generated by AI" label on PRs

on:
  pull_request:
    types: [opened, edited, synchronize, labeled]

permissions:
  contents: read
  pull-requests: write

jobs:
  strip-label:
    runs-on: ubuntu-latest
    steps:
      - name: Remove forbidden AI label if present
        uses: actions/github-script@v7
        with:
          script: |
            const forbiddenLabels = [
              'auto-generated by AI',
              'AI-generated',
              'ai generated',
              'auto generated by ai',
              'generated by ai',
            ].map(l => l.toLowerCase());

            const pr = context.payload.pull_request;
            if (!pr) {
              core.info('No pull_request context; skipping');
              return;
            }

            const prNumber = pr.number;
            const existing = (pr.labels || []).map(l => l.name.toLowerCase());
            const toRemove = existing.filter(l => forbiddenLabels.includes(l));

            if (toRemove.length === 0) {
              core.info('No forbidden labels to remove.');
              return;
            }

            for (const label of toRemove) {
              core.info(`Removing label '${label}' from PR #${prNumber}`);
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                name: label,
              }).catch(() => {});
            }

            core.setOutput('removed', toRemove.join(','));

